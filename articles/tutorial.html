<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="UFSCarISD">
<title>Tutorial • UFSCarISD</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Tutorial">
<meta property="og:description" content="UFSCarISD">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">UFSCarISD</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/tutorial.html">Tutorial</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Tutorial</h1>
            
      
      
      <div class="d-none name"><code>tutorial.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This tutorial will introduce the <code>sizeSpectra</code> package and
go over methods for estimating the exponent of a bounded power law
(<span class="math inline">\(\lambda\)</span>).</p>
</div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Size spectra (AKA Individual Size Distributions, Community Biomass
Distributions) are one of the many body-size abundance relationships.
Here, we will be focusing on Individual Size Distributions (ISD,
<em>sensu</em> White et al. 2007) where the biomass is measured (or
estimated) for every single individual within a community.</p>
<div class="section level3">
<h3 id="mathematical-basis">Mathematical basis<a class="anchor" aria-label="anchor" href="#mathematical-basis"></a>
</h3>
<p>The distribution of abundance (<span class="math inline">\(N\)</span>) to body size (<span class="math inline">\(M\)</span>) can be modeled as a bounded power law
(Andersen et al. 2016) in the form:</p>
<p><span class="math inline">\(\large N \propto M^ \lambda\)</span></p>
<p>Where <span class="math inline">\(\lambda\)</span> is the rate
parameter describing the decline in abundance with increasing body size
and is almost always negative. For pelagic marine systems, <span class="math inline">\(\lambda \approx -2\)</span> (Andersen and Beyer
2006, Wesner et al. 2024) and for stream communities <span class="math inline">\(\lambda\)</span> appears to be <span class="math inline">\(\approx -1.25\)</span> (Pomeranz et al. 2022,
Gjoni et al. 2024).</p>
<p>More negative values of <span class="math inline">\(\lambda\)</span>
(i.e., <span class="math inline">\(\lambda = -2\)</span>) are “steeper”
and values of <span class="math inline">\(\lambda\)</span> closer to 0
(i.e., <span class="math inline">\(\lambda = -0.5\)</span>) are
“shallower”. This means that “steep” relationships support less biomass
in the large body sizes, and “shallow” relationships have more biomass
in the larger body sizes.</p>
<div class="float">
<img src="trophic-pyramid.png" alt="Figure 1. Conceptual figure showing the difference in power law exponents. A) Plot showing the frequency distribution with increasing body sizes. Both communtities have the same size range (x-axis) but the “Steep” community has relatively lower abundance of large sized idividuals. B) A conceptual diagram of a trophic pyramid for a “shallow” community and C) for a “steep” community. Note that the abundance for the smallest body sizes (width of the purple bar) is the same in both communities, but the widths of the subsequent bars are smaller in the “steep” community, culiminating in only one fish compared with two fish in the “shallow” pyramid."><div class="figcaption">Figure 1. Conceptual figure showing the
difference in power law exponents. A) Plot showing the frequency
distribution with increasing body sizes. Both communtities have the same
size range (x-axis) but the “Steep” community has relatively lower
abundance of large sized idividuals. B) A conceptual diagram of a
trophic pyramid for a “shallow” community and C) for a “steep”
community. Note that the abundance for the smallest body sizes (width of
the purple bar) is the same in both communities, but the widths of the
subsequent bars are smaller in the “steep” community, culiminating in
only one fish compared with two fish in the “shallow” pyramid.</div>
</div>
<p><br><br></p>
<p>This has commonly been modeled in the literature by creating body
mass bins and counting (Abundance Size Spectra) or summing (Biomass size
spectra) the number of individuals in each bin. The bnned data is then
log-transformed and <span class="math inline">\(\lambda\)</span> is
estimated as the slope according to:</p>
<p><span class="math inline">\(\large log_{10}(N) = \lambda
log_{10}(M)\)</span></p>
<p>However, binning poses a number of issues and generally provides
estimates of <span class="math inline">\(\lambda\)</span> which are
inacurate and maximum likelihood methods are recommended (White et
al. 2008, Edwards et al. 2017, Pomeranz et al. 2024). One of the main
issues around binning methods is the choice of the width of the bins,
where the bin edges are located, and whether or not the counts (or sums)
in each bin should be normalized or not (Sprules and Barth 2016).</p>
</div>
</div>
<div class="section level2">
<h2 id="sizespectra-package">
<code>sizeSpectra</code> Package<a class="anchor" aria-label="anchor" href="#sizespectra-package"></a>
</h2>
<p>Make sure you have the <code>sizeSpectra</code> package downloaded.
You can download it directly from github using the <code>remotes</code>
package</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span>    <span class="co"># If you do not already have the "remotes" package</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"andrew-edwards/sizeSpectra"</span><span class="op">)</span></span></code></pre></div>
<p>Once the package is downloaded, we need to load it into our
session:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/andrew-edwards/sizeSpectra" class="external-link">sizeSpectra</a></span><span class="op">)</span></span></code></pre></div>
<p>For an overview of what the package can do, see the <a href="https://htmlpreview.github.io/?https://github.com/andrew-edwards/sizeSpectra/blob/master/doc/vignettes_overview.html" class="external-link"><em>sizeSpectra</em>
package vignettes</a></p>
</div>
<div class="section level2">
<h2 id="data-simulation">Data Simulation<a class="anchor" aria-label="anchor" href="#data-simulation"></a>
</h2>
<p>Let’s start off by simulating a vector of body size data. I first set
the seed to make these reproducible.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">598</span><span class="op">)</span> <span class="co"># makes simulation reproducible</span></span>
<span><span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sizeSpectra/man/Distributions.html" class="external-link">rPLB</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">100</span>, b <span class="op">=</span> <span class="op">-</span><span class="fl">2</span>, xmin <span class="op">=</span> <span class="fl">1</span>, xmax <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<p>The above code samples <code>n = 100</code> body sizes from a power
law with an exponent (<span class="math inline">\(\lambda\)</span>) of
<code>b = -2</code>. Becasue this is a bounded power law, we set the
minimum size (<code>xmin = 1</code>) and the maximum
(<code>xmax = 100</code>). You can think of this body size range as a
sample of fish from 1 to 100 grams. I have named it <code>m2</code> to
keep track of what exponent was used (i.e., <code>-2</code>).</p>
<p>Let’s sort the vector and view it:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   [1]  1.031254  1.050242  1.052482  1.068892  1.078987  1.090212  1.091879</span></span>
<span><span class="co">##   [8]  1.096940  1.097447  1.105043  1.105656  1.150811  1.170271  1.184734</span></span>
<span><span class="co">##  [15]  1.202709  1.252720  1.257296  1.329037  1.344897  1.374894  1.375970</span></span>
<span><span class="co">##  [22]  1.407335  1.424700  1.442556  1.477159  1.500558  1.510231  1.512183</span></span>
<span><span class="co">##  [29]  1.525338  1.543561  1.555712  1.567009  1.574345  1.579945  1.587565</span></span>
<span><span class="co">##  [36]  1.638134  1.663654  1.670502  1.679448  1.707943  1.714393  1.735188</span></span>
<span><span class="co">##  [43]  1.744063  1.801734  1.840380  1.852207  1.885163  1.988581  2.067230</span></span>
<span><span class="co">##  [50]  2.085163  2.097940  2.099015  2.099241  2.128986  2.135262  2.144477</span></span>
<span><span class="co">##  [57]  2.152524  2.218293  2.263141  2.502275  2.781777  2.905435  3.151122</span></span>
<span><span class="co">##  [64]  3.243437  3.352427  3.431242  3.612429  3.619371  3.757589  3.777959</span></span>
<span><span class="co">##  [71]  3.793802  3.841063  3.894318  3.957045  4.038995  4.308761  4.436295</span></span>
<span><span class="co">##  [78]  4.502082  4.634859  5.436690  5.564273  5.918682  6.008242  6.340840</span></span>
<span><span class="co">##  [85]  6.880768  6.987371  7.096980  7.183357  7.700765  8.836448 10.061311</span></span>
<span><span class="co">##  [92] 10.401013 11.740112 19.688841 23.269900 26.192331 30.367621 34.259411</span></span>
<span><span class="co">##  [99] 35.251265 39.758232</span></span></code></pre>
<p>We can see that most body sizes are less than 10, and there are very
few large body sizes in this sample. Note also that the largest body
size is ~40, even though we set our size bounds from 1 to 100.</p>
</div>
<div class="section level2">
<h2 id="estimating-lambda">Estimating <span class="math inline">\(\lambda\)</span><a class="anchor" aria-label="anchor" href="#estimating-lambda"></a>
</h2>
<p>We will estimate <span class="math inline">\(\lambda\)</span> from
this vector of body size data.</p>
<ul>
<li><p>We will use the <code><a href="https://rdrr.io/pkg/sizeSpectra/man/calcLike.html" class="external-link">calcLike()</a></code> function.<br></p></li>
<li>
<p>This function requires us to specify the
<code>negLL.fn = negLL.PLB</code>.</p>
<ul>
<li>We use this one becasue we have continuous body size estimates for
all individuals</li>
<li>More options and details on this later.</li>
</ul>
</li>
<li><p>We also need to supply information on the data including
<code>min</code>, <code>max</code>, <code>n</code>, and the sum of the
log-transformed values.</p></li>
<li><p>The code looks like this:</p></li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mle_lambda_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sizeSpectra/man/calcLike.html" class="external-link">calcLike</a></span><span class="op">(</span></span>
<span>      negLL.fn <span class="op">=</span> <span class="va">negLL.PLB</span>, <span class="co"># continuous estimates of all individuals</span></span>
<span>      x <span class="op">=</span> <span class="va">m2</span>, <span class="co"># the vector of data</span></span>
<span>      xmin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span>, <span class="co"># the minimum body size</span></span>
<span>      xmax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span>, <span class="co"># the maximum body size</span></span>
<span>      n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span>, <span class="co"># the number of observations</span></span>
<span>      sumlogx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span><span class="op">)</span>, <span class="co"># sum of log-transformed data</span></span>
<span>      p <span class="op">=</span> <span class="op">-</span><span class="fl">1.5</span><span class="op">)</span> <span class="co"># starting point, arbitrary number</span></span></code></pre></div>
<p>Let’s look at the result:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mle_lambda_2</span></span></code></pre></div>
<pre><code><span><span class="co">## $MLE</span></span>
<span><span class="co">## [1] -1.871733</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $conf</span></span>
<span><span class="co">## [1] -2.111733 -1.647733</span></span></code></pre>
<p>The results are returned as a list with <code>MLE</code> being the
estimate of <span class="math inline">\(\lambda\)</span> based on our
data.</p>
<p><code>conf</code> includes the lower and upper bound for a 95%
confidence interval of <span class="math inline">\(\lambda\)</span>.</p>
<p>So, based on the data we estimate that <span class="math inline">\(\lambda = -1.87\)</span> and the 95% confidence
interval is: <span class="math inline">\(-2.11, -1.65\)</span>.</p>
</div>
<div class="section level2">
<h2 id="plotting-estimates-and-data">Plotting estimates and data<a class="anchor" aria-label="anchor" href="#plotting-estimates-and-data"></a>
</h2>
<p>Edwards provides a function called <code><a href="https://rdrr.io/pkg/sizeSpectra/man/MLE.plot.html" class="external-link">MLE.plot()</a></code>. This
function requires a vector of body sizes and the MLE results.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/sizeSpectra/man/MLE.plot.html" class="external-link">MLE.plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">m2</span>, <span class="co"># vector of simulated body sizes</span></span>
<span>         b <span class="op">=</span> <span class="va">mle_lambda_2</span><span class="op">$</span><span class="va">MLE</span>, <span class="co">#lambda estimate</span></span>
<span>         confVals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mle_lambda_2</span><span class="op">$</span><span class="va">conf</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,<span class="co"># confidence interval</span></span>
<span>                      <span class="va">mle_lambda_2</span><span class="op">$</span><span class="va">conf</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>         panel <span class="op">=</span> <span class="st">"b"</span>, <span class="co">#This option includes the estimate and CI</span></span>
<span>         log<span class="op">=</span><span class="st">"xy"</span><span class="op">)</span> <span class="co"># you can change this to just x</span></span></code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>Here is the same plot as above but with only the x-axis log
transformed.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/sizeSpectra/man/MLE.plot.html" class="external-link">MLE.plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">m2</span>, </span>
<span>         b <span class="op">=</span> <span class="va">mle_lambda_2</span><span class="op">$</span><span class="va">MLE</span>, </span>
<span>         confVals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mle_lambda_2</span><span class="op">$</span><span class="va">conf</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>                      <span class="va">mle_lambda_2</span><span class="op">$</span><span class="va">conf</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>         panel <span class="op">=</span> <span class="st">"b"</span>, </span>
<span>         log<span class="op">=</span><span class="st">"x"</span><span class="op">)</span> <span class="co"># Just the x axis transformed</span></span></code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>There is an alternative option using <code>panel = "h"</code>. This
option displays the estimate of <span class="math inline">\(\lambda\)</span> on the figure, but cannot include
confidence itnervals.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/sizeSpectra/man/MLE.plot.html" class="external-link">MLE.plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">m2</span>, <span class="co"># vector of simulated body sizes</span></span>
<span>         b <span class="op">=</span> <span class="va">mle_lambda_2</span><span class="op">$</span><span class="va">MLE</span>, <span class="co">#lambda estimate</span></span>
<span>         panel <span class="op">=</span> <span class="st">"h"</span>, <span class="co">#This option includes the estimate and CI</span></span>
<span>         log<span class="op">=</span><span class="st">"xy"</span><span class="op">)</span> <span class="co"># you can also</span></span></code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<div class="section level3">
<h3 id="practice-problems">Practice Problems<a class="anchor" aria-label="anchor" href="#practice-problems"></a>
</h3>
<p>For the following problems, make sure to use new names of your
objects. You may want to add a new <code><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed()</a></code> command
before you simulate to make your results reproducible.</p>
<ol style="list-style-type: decimal">
<li><p>Make two new vectors of body size data but change the sample size
in each, i.e. <code>n=1000</code> and <code>n=50</code>. Name the two
new vectors <code>m2_high_n</code> and <code>m2_low_n</code>. Repeat the
analysis we just did for each of your new vectors. What happens to the
estimate <code>MLE</code> and the width of the confidence intervals?
Make one <code>panel="b"</code> plot for each of your new
results.</p></li>
<li><p>Make two new vectors of body size data with <code>n=1000</code>
but this time set <code>b = -1.5</code> and <code>b = -2.5</code>
(recall that <code>b</code> is <span class="math inline">\(\lambda\)</span> and controls the rate of decline.
Name your new vectors <code>m_1.5</code> and <code>m_2.5</code>. Print
out each of your new vectors using the <code><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort()</a></code> function. Pay
special attention to the largest and smallest body sizes sampled. How
often is the value of <code>xmin</code> and <code>xmax</code> observed?
Does this change with the “steepness” of the <span class="math inline">\(\lambda\)</span> value?</p></li>
</ol>
</div>
<div class="section level3">
<h3 id="binning-with-log2-bins">Binning with Log<sub>2</sub> Bins<a class="anchor" aria-label="anchor" href="#binning-with-log2-bins"></a>
</h3>
</div>
</div>
<div class="section level2">
<h2 id="working-with-real-data">Working with real data<a class="anchor" aria-label="anchor" href="#working-with-real-data"></a>
</h2>
<p>Data comes in all formats. Here I will show examples of the three
most common formats that I encounter: 1. All individuals have a body
mass estimate.<br>
2. There are counts of individuals with a given a body mass.<br>
3. Individuals are “binned” into broad categories of body mass.</p>
<div class="section level3">
<h3 id="data-format-all-indidividuals">Data format: All indidividuals<a class="anchor" aria-label="anchor" href="#data-format-all-indidividuals"></a>
</h3>
<p>I have included body size observations from a stream that I sampled
in New Zealand. This data is a vector of <span class="math inline">\(1,809\)</span> individual body sizes. Every
individual was measured and body mass was estimated using length-weight
regressions. You can load the data with the following command. I also
print out the first 50 observations for reference.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"ohc"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ohc</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1809</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ohc</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">50</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] 0.002960 0.008360 0.089500 0.071900 0.902721 0.115630 0.383170 4.316831</span></span>
<span><span class="co">##  [9] 0.867969 0.110412 5.223146 3.984150 0.537623 0.202904 0.081500 0.138040</span></span>
<span><span class="co">## [17] 4.783700 2.808926 0.324729 0.287618 0.284727 0.313896 0.356644 0.229078</span></span>
<span><span class="co">## [25] 0.944642 4.018426 6.076952 3.605317 0.675048 3.173486 2.651296 3.402837</span></span>
<span><span class="co">## [33] 4.201791 4.083355 3.195994 3.777321 1.932435 2.571302 0.026100 0.030900</span></span>
<span><span class="co">## [41] 1.637724 5.162719 2.702034 0.029500 0.159526 0.023000 3.184728 1.038125</span></span>
<span><span class="co">## [49] 0.055900 0.055900</span></span></code></pre>
<p>This data set has body mass for all individuals so we can just plug
it into our same <code><a href="https://rdrr.io/pkg/sizeSpectra/man/calcLike.html" class="external-link">calcLike()</a></code> function as above. I will add
the <code>suppress.warnings = TRUE</code> argument as well.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mle_ohc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sizeSpectra/man/calcLike.html" class="external-link">calcLike</a></span><span class="op">(</span></span>
<span>      negLL.fn <span class="op">=</span> <span class="va">negLL.PLB</span>, </span>
<span>      x <span class="op">=</span> <span class="va">ohc</span>, </span>
<span>      xmin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">ohc</span><span class="op">)</span>, </span>
<span>      xmax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">ohc</span><span class="op">)</span>, </span>
<span>      n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ohc</span><span class="op">)</span>, </span>
<span>      sumlogx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">ohc</span><span class="op">)</span><span class="op">)</span>, </span>
<span>      p <span class="op">=</span> <span class="op">-</span><span class="fl">1.5</span>,</span>
<span>      suppress.warnings <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">mle_ohc</span></span></code></pre></div>
<pre><code><span><span class="co">## $MLE</span></span>
<span><span class="co">## [1] -1.088692</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $conf</span></span>
<span><span class="co">## [1] -1.105692 -1.071692</span></span></code></pre>
<p>As one more example, we can plot these results as above.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/sizeSpectra/man/MLE.plot.html" class="external-link">MLE.plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">ohc</span>, </span>
<span>         b <span class="op">=</span> <span class="va">mle_ohc</span><span class="op">$</span><span class="va">MLE</span>,</span>
<span>         panel <span class="op">=</span> <span class="st">"h"</span>, </span>
<span>         log<span class="op">=</span><span class="st">"xy"</span><span class="op">)</span> </span></code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="data-format-count-of-body-sizes">Data Format: Count of body sizes<a class="anchor" aria-label="anchor" href="#data-format-count-of-body-sizes"></a>
</h3>
<p>We don’t always have an individual observation for every single
individual in our sample. For example, the NEON data set that I have
worked with extensively collects macroinvertebrates and fish on
different scales. In order to combine these, we have calculated an
estimated count of individuals of a given body size on a per m^2
basis.</p>
<p>I have included an example of this from West St. Louis Creek in the
Rocky Mountains of Colorado. You can load the data with the following
command.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"WLOU"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">WLOU</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 4</span></span></span>
<span><span class="co">##   site_date       organism_group body_mass count_m2</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> WLOU_2021-09-20 Fish                 100  0.003<span style="text-decoration: underline;">38</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> WLOU_2021-09-20 Fish                 140  0.003<span style="text-decoration: underline;">14</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> WLOU_2021-09-20 Fish                 180  0.003<span style="text-decoration: underline;">24</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> WLOU_2021-09-20 Fish                 220  0.003<span style="text-decoration: underline;">24</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> WLOU_2021-09-20 Fish                 300  0.003<span style="text-decoration: underline;">32</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> WLOU_2021-09-20 Fish                 520  0.002<span style="text-decoration: underline;">98</span></span></span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mle_WLOU</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sizeSpectra/man/calcLike.html" class="external-link">calcLike</a></span><span class="op">(</span></span>
<span>      negLL.fn <span class="op">=</span> <span class="va">negLL.PLB.counts</span>, </span>
<span>      x <span class="op">=</span> <span class="va">WLOU</span><span class="op">$</span><span class="va">body_mass</span>,</span>
<span>      c <span class="op">=</span> <span class="va">WLOU</span><span class="op">$</span><span class="va">count_m2</span>, </span>
<span>      p <span class="op">=</span> <span class="op">-</span><span class="fl">1.5</span>,</span>
<span>      suppress.warnings <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">mle_WLOU</span></span></code></pre></div>
<pre><code><span><span class="co">## $MLE</span></span>
<span><span class="co">## [1] -1.54202</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $conf</span></span>
<span><span class="co">## [1] -1.55102 -1.53302</span></span></code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/sizeSpectra/man/MLE.plot.html" class="external-link">MLE.plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">WLOU</span><span class="op">$</span><span class="va">body_mass</span>, </span>
<span>         b <span class="op">=</span> <span class="va">mle_WLOU</span><span class="op">$</span><span class="va">MLE</span>,</span>
<span>         panel <span class="op">=</span> <span class="st">"h"</span>, </span>
<span>         log<span class="op">=</span><span class="st">"xy"</span><span class="op">)</span> </span></code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-16-1.png" width="700"><br> Notice that empirical data is much messier and does not generally
“fit” the red line nearly as nicely as simulated data.</p>
</div>
<div class="section level3">
<h3 id="data-format-binned-data">Data Format: Binned data<a class="anchor" aria-label="anchor" href="#data-format-binned-data"></a>
</h3>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"fish_binned"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">num.bins</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">fish_binned</span><span class="op">)</span></span>
<span><span class="va">binBreaks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">(</span><span class="va">fish_binned</span><span class="op">$</span><span class="va">binMin</span><span class="op">)</span>,</span>
<span>  <span class="op">(</span><span class="va">fish_binned</span><span class="op">$</span><span class="va">binMax</span><span class="op">)</span><span class="op">[</span><span class="va">num.bins</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">binCounts</span> <span class="op">&lt;-</span> <span class="va">fish_binned</span><span class="op">$</span><span class="va">n</span></span>
<span></span>
<span></span>
<span><span class="va">mle_fish_bin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sizeSpectra/man/calcLike.html" class="external-link">calcLike</a></span><span class="op">(</span></span>
<span>  negLL.fn <span class="op">=</span> <span class="va">negLL.PLB.binned</span>,</span>
<span>  p <span class="op">=</span> <span class="op">-</span><span class="fl">2.5</span>,</span>
<span>  w <span class="op">=</span> <span class="va">binBreaks</span>,</span>
<span>  d <span class="op">=</span> <span class="va">binCounts</span>,</span>
<span>  J <span class="op">=</span> <span class="va">num.bins</span>,</span>
<span>  vecDiff <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  suppress.warnings <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mle_fish_bin</span> </span></code></pre></div>
<pre><code><span><span class="co">## $MLE</span></span>
<span><span class="co">## [1] -1.737086</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $conf</span></span>
<span><span class="co">## [1] -1.775086 -1.700086</span></span></code></pre>
<p><br></p>
<p>When using binned data, there is a different function that Edwards
recommends for plotting.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># LBN_bin_plot(binValsTibble = x.binned$binVals, # modify </span></span>
<span><span class="co">#              b.MLE = mle_fish_bin$MLE,</span></span>
<span><span class="co">#              b.confMin = mle_fish_bin$conf[1],</span></span>
<span><span class="co">#              b.confMax = mle_fish_bin$conf[2],</span></span>
<span><span class="co">#              leg.text = "(c)",</span></span>
<span><span class="co">#              log.xy = "xy",</span></span>
<span><span class="co">#              plot.binned.fitted = FALSE)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="working-with-data-from-multiple-sites">Working with data from multiple sites<a class="anchor" aria-label="anchor" href="#working-with-data-from-multiple-sites"></a>
</h2>
<p>For this example, there is a data set included in the package called
<code>isd_gradient</code>. This is simulated data from three sites
across a hypothetical environmental gradient. The data was simulated so
that <span class="math inline">\(\lambda\)</span> from the three sites
is equal to <code>-1</code>, <code>-1.5</code>, and <code>-2</code>,
respectively.</p>
<div class="section level3">
<h3 id="load-the-data">Load the data<a class="anchor" aria-label="anchor" href="#load-the-data"></a>
</h3>
<p>Load the data and inspect it.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"isd_gradient"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">isd_gradient</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    body_mass env_value site_name</span></span>
<span><span class="co">## 1  22.870249        -1    Site_A</span></span>
<span><span class="co">## 2 361.130908        -1    Site_A</span></span>
<span><span class="co">## 3   2.897582        -1    Site_A</span></span>
<span><span class="co">## 4  97.524733        -1    Site_A</span></span>
<span><span class="co">## 5   3.578355        -1    Site_A</span></span>
<span><span class="co">## 6  51.687566        -1    Site_A</span></span></code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">isd_gradient</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 6000    3</span></span></code></pre>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">isd_gradient</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "body_mass" "env_value" "site_name"</span></span></code></pre>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">isd_gradient</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    body_mass         env_value   site_name        </span></span>
<span><span class="co">##  Min.   :  1.000   Min.   :-1   Length:6000       </span></span>
<span><span class="co">##  1st Qu.:  1.708   1st Qu.:-1   Class :character  </span></span>
<span><span class="co">##  Median :  4.111   Median : 0   Mode  :character  </span></span>
<span><span class="co">##  Mean   : 59.893   Mean   : 0                     </span></span>
<span><span class="co">##  3rd Qu.: 23.348   3rd Qu.: 1                     </span></span>
<span><span class="co">##  Max.   :990.733   Max.   : 1</span></span></code></pre>
<p>There are a number of ways to treat the data. One of the simplest (?)
is to:<br>
1. Split the data into a list where each item in the list is the data
for one site.<br>
2. Use a <code>for</code> loop to estimate <span class="math inline">\(\lambda\)</span> from each site.<br>
3. Store the results of the <code>for</code> loop in a data frame for
plotting and analysis.</p>
</div>
<div class="section level3">
<h3 id="split-the-data">Split the data<a class="anchor" aria-label="anchor" href="#split-the-data"></a>
</h3>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">isd_gradient</span>, <span class="va">isd_gradient</span><span class="op">$</span><span class="va">site_name</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">dat_list</span>, <span class="va">head</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $Site_A</span></span>
<span><span class="co">##    body_mass env_value site_name</span></span>
<span><span class="co">## 1  22.870249        -1    Site_A</span></span>
<span><span class="co">## 2 361.130908        -1    Site_A</span></span>
<span><span class="co">## 3   2.897582        -1    Site_A</span></span>
<span><span class="co">## 4  97.524733        -1    Site_A</span></span>
<span><span class="co">## 5   3.578355        -1    Site_A</span></span>
<span><span class="co">## 6  51.687566        -1    Site_A</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Site_Q</span></span>
<span><span class="co">##      body_mass env_value site_name</span></span>
<span><span class="co">## 4001  2.427277         1    Site_Q</span></span>
<span><span class="co">## 4002  4.509971         1    Site_Q</span></span>
<span><span class="co">## 4003  2.391459         1    Site_Q</span></span>
<span><span class="co">## 4004  7.357234         1    Site_Q</span></span>
<span><span class="co">## 4005  1.337427         1    Site_Q</span></span>
<span><span class="co">## 4006  4.251009         1    Site_Q</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Site_X</span></span>
<span><span class="co">##      body_mass env_value site_name</span></span>
<span><span class="co">## 2001 17.910886         0    Site_X</span></span>
<span><span class="co">## 2002  1.999680         0    Site_X</span></span>
<span><span class="co">## 2003  1.918008         0    Site_X</span></span>
<span><span class="co">## 2004  1.284891         0    Site_X</span></span>
<span><span class="co">## 2005  2.195040         0    Site_X</span></span>
<span><span class="co">## 2006  1.692335         0    Site_X</span></span></code></pre>
<p><code>data_list</code> is now a list with 3 elements in it, one
element for each site.</p>
</div>
<div class="section level3">
<h3 id="for-loop">
<code>for</code> loop<a class="anchor" aria-label="anchor" href="#for-loop"></a>
</h3>
<p>In case you are not familiar with <code>for</code> loops, these are
ways of performing a repeated set of functions on different sets or
pieces of data. Generally, a <code>for</code> loop has the following
pieces.</p>
<ol style="list-style-type: decimal">
<li>Make an empty object to “catch” the results.<br>
</li>
<li>Set the bounds of the loop.<br>
</li>
<li>Write the <code>for</code> loop</li>
</ol>
<p><code>for</code> loops generally look like this:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat_object</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="co"># empty object to catch data</span></span>
<span>  col_name_1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>, <span class="co"># name the columns and give them a class</span></span>
<span>  col_name_2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="co"># use "n" to repeat the number of rows</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">index</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span><span class="op">{</span> <span class="co"># set the bounds. This will run through from 1:n</span></span>
<span>  <span class="co"># body, this is where you write your code make your calculations</span></span>
<span>  <span class="op">}</span></span></code></pre></div>
<div class="section level4">
<h4 id="make-an-empty-data-frame">Make an empty data frame<a class="anchor" aria-label="anchor" href="#make-an-empty-data-frame"></a>
</h4>
<p>The five pieces of information I want from the analysis are the
<code>site_name</code>, <code>env_value</code>, the estimated
<code>b</code>, and the bounds of the confidence interval for the
estimate (<code>CI_low</code>, <code>CI_high</code>).</p>
<p>So, I will make an empty list to catch the results.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">dat_list</span><span class="op">)</span></span>
<span><span class="va">n</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 3</span></span></code></pre>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">isd_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    site_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>,</span>
<span>    env_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>,</span>
<span>    b <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>, </span>
<span>    CI_low <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>,</span>
<span>    CI_high <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">isd_result</span></span></code></pre></div>
<pre><code><span><span class="co">##   site_name env_value b CI_low CI_high</span></span>
<span><span class="co">## 1                   0 0      0       0</span></span>
<span><span class="co">## 2                   0 0      0       0</span></span>
<span><span class="co">## 3                   0 0      0       0</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="set-bounds-and-write-the-for-loop">Set bounds and write the <code>for</code> loop<a class="anchor" aria-label="anchor" href="#set-bounds-and-write-the-for-loop"></a>
</h4>
<p>My <code>data_list</code> has three elements in it. So we will use
the <code><a href="https://rdrr.io/r/base/length.html" class="external-link">length()</a></code> function to set the bounds of the loop.<br>
* I will use <code>length(data_list)</code> to get the value of 3.<br>
* I will abbreviate <code>index</code> above to just be the letter
<code>i</code>.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># read one piece of the list in at a time</span></span>
<span>  <span class="va">dat_in</span> <span class="op">&lt;-</span> <span class="va">dat_list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> </span>
<span>  <span class="co"># extract the relevant information from the dat_in object </span></span>
<span>  <span class="va">body_mass</span> <span class="op">&lt;-</span> <span class="va">dat_in</span><span class="op">$</span><span class="va">body_mass</span></span>
<span>  <span class="va">site_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dat_in</span><span class="op">$</span><span class="va">site_name</span><span class="op">)</span></span>
<span>  <span class="va">env_value</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dat_in</span><span class="op">$</span><span class="va">env_value</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">mle_estimate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sizeSpectra/man/calcLike.html" class="external-link">calcLike</a></span><span class="op">(</span></span>
<span>      negLL.fn <span class="op">=</span> <span class="va">negLL.PLB</span>, </span>
<span>      x <span class="op">=</span> <span class="va">body_mass</span>, </span>
<span>      xmin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">body_mass</span><span class="op">)</span>, </span>
<span>      xmax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">body_mass</span><span class="op">)</span>, </span>
<span>      n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">body_mass</span><span class="op">)</span>, </span>
<span>      sumlogx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">body_mass</span><span class="op">)</span><span class="op">)</span>, </span>
<span>      p <span class="op">=</span> <span class="op">-</span><span class="fl">1.5</span>,</span>
<span>      suppress.warnings <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span>
<span>  </span>
<span>  <span class="co"># now save all the relevant information in the data frame</span></span>
<span>  <span class="co"># Make sure to put them in the right spot</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="va">isd_result</span><span class="op">$</span><span class="va">site_name</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">site_name</span></span>
<span>  <span class="va">isd_result</span><span class="op">$</span><span class="va">env_value</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">env_value</span></span>
<span>  <span class="va">isd_result</span><span class="op">$</span><span class="va">b</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">mle_estimate</span><span class="op">$</span><span class="va">MLE</span></span>
<span>  <span class="va">isd_result</span><span class="op">$</span><span class="va">CI_low</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">mle_estimate</span><span class="op">$</span><span class="va">conf</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">isd_result</span><span class="op">$</span><span class="va">CI_high</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">mle_estimate</span><span class="op">$</span><span class="va">conf</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<p>We now have our three results in a list and we can easily combine
them into a single data.frame using the <code><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind()</a></code>
command.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">isd_result</span></span></code></pre></div>
<pre><code><span><span class="co">##   site_name env_value         b    CI_low    CI_high</span></span>
<span><span class="co">## 1    Site_A        -1 -1.012709 -1.034709 -0.9907085</span></span>
<span><span class="co">## 2    Site_Q         1 -2.003629 -2.049629 -1.9586290</span></span>
<span><span class="co">## 3    Site_X         0 -1.498724 -1.526724 -1.4707235</span></span></code></pre>
<p>Now we can plot these results using <code>ggplot2</code> library.</p>
<p>If you don’t already have <code>ggplot2</code>, you can install it by
running the following (only once per machine):
<code>install.packages("ggplot2")</code></p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">isd_result</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">env_value</span>,</span>
<span>           y <span class="op">=</span> <span class="va">b</span>,</span>
<span>           ymin <span class="op">=</span> <span class="va">CI_low</span>,</span>
<span>           ymax <span class="op">=</span> <span class="va">CI_high</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_pointrange</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-26-1.png" width="700"><br> We can also add a line of best fit using the
<code>stat_smooth(method = "lm")</code> command.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">isd_result</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">env_value</span>,</span>
<span>           y <span class="op">=</span> <span class="va">b</span>,</span>
<span>           ymin <span class="op">=</span> <span class="va">CI_low</span>,</span>
<span>           ymax <span class="op">=</span> <span class="va">CI_high</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_pointrange</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">stat_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span><span class="op">)</span></span></code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-27-1.png" width="700"></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Andersen, K. H., and J. E. Beyer. 2006. Asymptotic Size Determines
Species Abundance in the Marine Size Spectrum. The American Naturalist
168:54–61.</p>
<p>Andersen, K. H., J. L. Blanchard, E. A. Fulton, H. Gislason, N. S.
Jacobsen, and T. van Kooten. 2016. Assumptions behind size-based
ecosystem models are realistic. ICES Journal of Marine Science
73:1651–1655.</p>
<p>Edwards, A. M. (2020). sizeSpectra: R package for fitting size
spectra to ecological data (including binned data). <a href="https://github.com/andrew-edwards/sizeSpectra" class="external-link uri">https://github.com/andrew-edwards/sizeSpectra</a> Google
Scholar</p>
<p>Edwards, A. M., Robinson, J., Blanchard, J., Baum, J., &amp; Plank,
M. (2020). Accounting for the bin structure of data removes bias when
fitting size spectra. Marine Ecology Progress Series, 636, 19–33.</p>
<p>Edwards, A. M., Robinson, J., Plank, M., Baum, J., &amp; Blanchard,
J. (2017). Testing and recommending methods for fitting size spectra to
data. Methods in Ecology and Evolution, 8, 57–67.</p>
<p>Gjoni, V., J. P. F. Pomeranz, J. R. Junker, and J. S. Wesner. 2024,
January 11. Size spectra in freshwater streams are consistent across
temperature and resource supply. bioRxiv.</p>
<p>Pomeranz, J. P. F., J. R. Junker, and J. S. Wesner. 2022. Individual
size distributions across North American streams vary with local
temperature. Global Change Biology 28:848–858.</p>
<p>Pomeranz, J., J. R. Junker, V. Gjoni, and J. S. Wesner. 2024. Maximum
likelihood outperforms binning methods for detecting differences in
abundance size spectra across environmental gradients. Journal of Animal
Ecology 93:267–280.</p>
<p>Sprules, W. G., and L. E. Barth. 2016. Surfing the biomass size
spectrum: some remarks on history, theory, and application. Canadian
Journal of Fisheries and Aquatic Sciences 73:477–495.</p>
<p>White, E. P., S. K. M. Ernest, A. J. Kerkhoff, and B. J. Enquist.
2007. Relationships between body size and abundance in ecology. Trends
in Ecology &amp; Evolution 22:323–330.</p>
<p>White, E. P., B. J. Enquist, and J. L. Green. 2008. On Estimating the
Exponent of Power-Law Frequency Distributions. Ecology 89:905–912.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by The package maintainer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
